<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agenda e Reservas - Intranet Corporativa</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <style>
      body {
        min-height: 100vh;
        display: flex;
      }
      .sidebar {
        width: 280px;
        flex-shrink: 0;
      }
      .nav-pills .nav-link.active,
      .nav-pills .show > .nav-link {
        color: #fff;
        background-color: #0d6efd;
      }
      .table-striped > tbody > tr:nth-of-type(odd) > * {
        --bs-table-accent-bg: var(--bs-table-striped-bg);
         color: var(--bs-table-striped-color, var(--bs-body-color));
      }
      .table th, .table td {
        vertical-align: middle;
      }
      #agenda-date {
        max-width: 250px;
      }
    </style>
  </head>
  <body class="bg-light">
    <aside
      class="d-flex flex-column flex-shrink-0 p-3 text-white bg-dark sidebar"
    >
      <a
        href="index.html"
        class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none"
      >
        <i class="bi bi-building-gear me-2" style="font-size: 1.5rem"></i>
        <span class="fs-4">Intranet</span>
      </a>
      <hr />
      <ul class="nav nav-pills flex-column mb-auto">
        <li class="nav-item">
          <a href="central_de_telefonia.html" class="nav-link text-white"
            ><i class="bi bi-telephone me-2"></i>Central de Telefonia</a
          >
        </li>
        <li>
          <a href="documentos_internos.html" class="nav-link text-white"
            ><i class="bi bi-file-earmark-text me-2"></i>Documentos Internos</a
          >
        </li>
        <li>
          <a href="portal_do_colaborador.html" class="nav-link text-white"
            ><i class="bi bi-person-badge me-2"></i>Portal do Colaborador</a
          >
        </li>
        <li>
          <a href="chamados_help_desk.html" class="nav-link text-white"
            ><i class="bi bi-headset me-2"></i>Chamados (Help Desk)</a
          >
        </li>
        <li>
          <a href="agenda_e_reservas.html" class="nav-link active" aria-current="page"
            ><i class="bi bi-calendar-week me-2"></i>Agenda e Reservas</a
          >
        </li>
        <li>
          <a href="ordens_de_servico.html" class="nav-link text-white"
            ><i class="bi bi-card-checklist me-2"></i>Ordens de Serviço</a
          >
        </li>
        <li>
          <a href="wiki_interna.html" class="nav-link text-white"
            ><i class="bi bi-wikipedia me-2"></i>Wiki Interna</a
          >
        </li>
        <li>
          <a href="treinamentos.html" class="nav-link text-white"
            ><i class="bi bi-mortarboard me-2"></i>Treinamentos</a
          >
        </li>
        <li>
          <a href="ocorrencias.html" class="nav-link text-white"
            ><i class="bi bi-exclamation-octagon me-2"></i>Ocorrências</a
          >
        </li>
        <li>
          <a href="central_de_ideias.html" class="nav-link text-white"
            ><i class="bi bi-lightbulb me-2"></i>Central de Ideias</a
          >
        </li>
        <li>
          <a href="indicadores_bi.html" class="nav-link text-white"
            ><i class="bi bi-bar-chart-line me-2"></i>Indicadores (BI)</a
          >
        </li>
        <li>
          <a href="comunicados.html" class="nav-link text-white"
            ><i class="bi bi-megaphone me-2"></i>Comunicados</a
          >
        </li>
        <li>
          <a href="catalogo_de_materiais.html" class="nav-link text-white"
            ><i class="bi bi-box-seam me-2"></i>Catálogo de Materiais</a
          >
        </li>
      </ul>
      <hr />
    </aside>

    <main class="flex-grow-1 p-4">
      <header class="pb-3 mb-4 border-bottom">
        <h1 class="display-5">Agenda e Reservas</h1>
        <p class="text-muted">Selecione um recurso, escolha uma data, e clique em um horário disponível para reservar.</p>
      </header>

      <div class="row g-4">
        <div class="col-lg-5">
          <div class="card shadow-sm">
            <div class="card-header">
              <h5>Selecione o Recurso</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                  <label for="recurso" class="form-label">Recurso</label>
                  <select class="form-select" id="recurso">
                    <option>Selecione o recurso...</option>
                    <option value="1">Carrinho de Chromebook</option>
                    <option value="2">Chromebook</option>
                    <option value="3">Caixa de Som</option>
                  </select>
                </div>
                 <div class="alert alert-info" role="alert">
                  <i class="bi bi-info-circle-fill me-2"></i>
                  Para reservar, selecione um recurso, a data desejada e depois clique em um horário disponível.
                </div>
            </div>
          </div>
        </div>

        <div class="col-lg-7">
          <div class="card shadow-sm">
            <div class="card-header">
              <h5>Agenda de Horários</h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label for="agenda-date" class="form-label"><strong>Selecione a Data:</strong></label>
                <input type="date" class="form-control" id="agenda-date">
              </div>
              <div class="table-responsive">
                  <table class="table table-bordered table-striped text-center">
                      <thead class="table-light">
                          <tr>
                              <th>Horário</th>
                              <th>Status</th>
                              <th>Ação</th>
                          </tr>
                      </thead>
                      <tbody id="calendar-body">
                          </tbody>
                  </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script>
      // Função para renderizar a agenda com base na data selecionada
      function renderCalendar(selectedDateStr) {
        const calendarBody = document.getElementById('calendar-body');
        calendarBody.innerHTML = ''; // Limpa a agenda antes de renderizar

        const today = new Date();
        today.setHours(0, 0, 0, 0); // Zera o tempo para comparar apenas a data

        // Trata a string da data para evitar problemas com fuso horário
        const selectedDate = new Date(selectedDateStr + 'T00:00:00');
        const currentHour = new Date().getHours();
        
        const isToday = (selectedDate.getTime() === today.getTime());
        const isPastDate = selectedDate < today;

        const startTime = 7;
        const endTime = 18;

        for (let hour = startTime; hour < endTime; hour++) {
          const row = document.createElement('tr');
          const timeSlot = `${String(hour).padStart(2, '0')}:00 - ${String(hour + 1).padStart(2, '0')}:00`;
          const startTimeStr = `${String(hour).padStart(2, '0')}:00`;
          
          let status, button;

          if (isPastDate) {
            status = '<span class="badge bg-secondary">Data Passada</span>';
            button = '<button class="btn btn-secondary btn-sm" disabled>Indisponível</button>';
          } else if (isToday && hour < currentHour) {
            status = '<span class="badge bg-secondary">Encerrado</span>';
            button = '<button class="btn btn-secondary btn-sm" disabled>Indisponível</button>';
          } else if (hour === 10) { // Mantém o horário de exemplo como ocupado
            status = '<span class="badge bg-danger">Ocupado</span>';
            button = '<button class="btn btn-danger btn-sm" disabled>Indisponível</button>';
          } else { // Horário futuro ou de hoje que ainda não passou
            status = '<span class="badge bg-success">Disponível</span>';
            button = `<button class="btn btn-success btn-sm" onclick="reservar('${startTimeStr}')">Reservar</button>`;
          }

          row.innerHTML = `
            <td><i class="bi bi-clock me-2"></i>${timeSlot}</td>
            <td>${status}</td>
            <td class="text-end">${button}</td>
          `;
          calendarBody.appendChild(row);
        }
      }

      document.addEventListener('DOMContentLoaded', function() {
        const dateInput = document.getElementById('agenda-date');
        
        // Define a data inicial como hoje
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        const todayStr = `${year}-${month}-${day}`;

        dateInput.value = todayStr;
        
        // Renderiza o calendário pela primeira vez com a data de hoje
        renderCalendar(todayStr);

        // Adiciona um listener para atualizar o calendário quando a data mudar
        dateInput.addEventListener('change', function() {
          renderCalendar(this.value);
        });
      });

      function reservar(hora) {
          const recursoSelect = document.getElementById('recurso');
          const recursoId = recursoSelect.value;
          const recursoNome = recursoSelect.options[recursoSelect.selectedIndex].text;
          
          // Pega a data do seletor de data
          const dateValue = document.getElementById('agenda-date').value; // Formato YYYY-MM-DD
          const [year, month, day] = dateValue.split('-');
          const dataFormatada = `${day}/${month}/${year}`;

          if (!recursoId || recursoNome === 'Selecione o recurso...') {
              alert("Por favor, selecione um recurso na caixa à esquerda antes de continuar.");
              recursoSelect.focus();
              return;
          }
          
          const params = new URLSearchParams({
              recursoId: recursoId,
              recursoNome: recursoNome,
              data: dataFormatada,
              hora: hora
          });

          window.location.href = `confirmar_reserva.html?${params.toString()}`;
      }
    </script>
  </body>
</html>